<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="shortcut icon" href="../../img/favicon.ico">
  <title>MAC Addresses - IXP Manager Documentation</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../../css/highlight.css">
  
  <script>
    // Current page data
    var mkdocs_page_name = "MAC Addresses";
    var mkdocs_page_input_path = "features/layer2-addresses.md";
    var mkdocs_page_url = "/features/layer2-addresses/";
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js"></script>
  <script src="../../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../../js/highlight.pack.js"></script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> IXP Manager Documentation</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="../..">Home</a>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Installation</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../install/">Introduction</a>
                </li>
                <li class="">
                    
    <a class="" href="../../install/automated-script/">Automated Script</a>
                </li>
                <li class="">
                    
    <a class="" href="../../install/maint-mode/">Maintenance Mode</a>
                </li>
                <li class="">
                    
    <a class="" href="../../install/manually/">Manual Installation</a>
                </li>
                <li class="">
                    
    <a class="" href="../../install/upgrading/">Upgrading</a>
                </li>
                <li class="">
                    
    <a class="" href="../../install/upgrade-v3/">Upgrade From v3</a>
                </li>
                <li class="">
                    
    <a class="" href="../../install/runtime/">Runtime Configuration</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">General Usage</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../usage/customers/">Customers / Members</a>
                </li>
                <li class="">
                    
    <a class="" href="../../usage/customer-notes/">Customer Notes</a>
                </li>
                <li class="">
                    
    <a class="" href="../../usage/customer-tags/">Customer Tags</a>
                </li>
                <li class="">
                    
    <a class="" href="../../usage/interfaces/">Customer Connections</a>
                </li>
                <li class="">
                    
    <a class="" href="../../usage/users/">Users & Contacts</a>
                </li>
                <li class="">
                    
    <a class="" href="../../usage/switches/">Switches</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Features</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../api/">API</a>
                </li>
                <li class="">
                    
    <a class="" href="../as112/">AS112</a>
                </li>
                <li class="">
                    
    <a class="" href="../console-servers/">Console Servers</a>
                </li>
                <li class="">
                    
    <a class="" href="../contact-groups/">Contact Groups</a>
                </li>
                <li class="">
                    
    <a class="" href="../patch-panels/">Cross Connects</a>
                </li>
                <li class="">
                    
    <a class="" href="../dns-arpa/">DNS / ARPA</a>
                </li>
                <li class="">
                    
    <a class="" href="../../grapher/introduction/">Grapher</a>
                </li>
                <li class="">
                    
    <a class="" href="../helpdesk/">Helpdesk Integration</a>
                </li>
                <li class="">
                    
    <a class="" href="../irrdb/">IRRDB</a>
                </li>
                <li class="">
                    
    <a class="" href="../ixf-export/">IX-F Member Export</a>
                </li>
                <li class="">
                    
    <a class="" href="./">MAC Addresses</a>
                </li>
                <li class="">
                    
    <a class="" href="../looking-glass/">Looking Glass</a>
                </li>
                <li class=" current">
                    
    <a class="current" href="./">MAC Addresses</a>
    <ul class="subnav">
            
    <li class="toctree-l3"><a href="#mac-addresses">MAC Addresses</a></li>
    
        <ul>
        
            <li><a class="toctree-l4" href="#configured-addresses">Configured Addresses</a></li>
        
            <li><a class="toctree-l4" href="#discovered-mac-addresses">Discovered MAC Addresses</a></li>
        
            <li><a class="toctree-l4" href="#oui-database">OUI Database</a></li>
        
            <li><a class="toctree-l4" href="#end-user-access">End User Access</a></li>
        
        </ul>
    

    </ul>
                </li>
                <li class="">
                    
    <a class="" href="../member-export/">Member Export</a>
                </li>
                <li class="">
                    
    <a class="" href="../mailing-lists/">Mailing List Management</a>
                </li>
                <li class="">
                    
    <a class="" href="../nagios/">Nagios</a>
                </li>
                <li class="">
                    
    <a class="" href="../patch-panels/">Patch Panels</a>
                </li>
                <li class="">
                    
    <a class="" href="../peering-manager/">Peering Manager</a>
                </li>
                <li class="">
                    
    <a class="" href="../peering-matrix/">Peering Matrix</a>
                </li>
                <li class="">
                    
    <a class="" href="../reseller/">Reseller Functionality</a>
                </li>
                <li class="">
                    
    <a class="" href="../route-collectors/">Route Collectors</a>
                </li>
                <li class="">
                    
    <a class="" href="../route-servers/">Route Servers</a>
                </li>
                <li class="">
                    
    <a class="" href="../routers/">Router Configuration</a>
                </li>
                <li class="">
                    
    <a class="" href="../skinning/">Skinning</a>
                </li>
                <li class="">
                    
    <a class="" href="../../grapher/smokeping/">Smokeping</a>
                </li>
                <li class="">
                    
    <a class="" href="../static-content/">Static Content</a>
                </li>
                <li class="">
                    
    <a class="" href="../tacacs/">TACACS</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Grapher</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../grapher/introduction/">Introduction</a>
                </li>
                <li class="">
                    
    <a class="" href="../../grapher/api/">API &amp; Permissions</a>
                </li>
                <li class="">
                    
    <a class="" href="../../grapher/mrtg/">Backend: MRTG</a>
                </li>
                <li class="">
                    
    <a class="" href="../../grapher/sflow/">Backend: sflow</a>
                </li>
                <li class="">
                    
    <a class="" href="../../grapher/smokeping/">Backend: Smokeping</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Sflow Support</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../sflow/">Introduction</a>
                </li>
                <li class="">
                    
    <a class="" href="../sflow-p2p/">Peer-to-peer Graphs</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Development</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../dev/api/">API</a>
                </li>
                <li class="">
                    
    <a class="" href="../../dev/ci/">Continuous Integration</a>
                </li>
                <li class="">
                    
    <a class="" href="../../dev/cla/">Contributer License Agreement</a>
                </li>
                <li class="">
                    
    <a class="" href="../../dev/docker/">Docker</a>
                </li>
                <li class="">
                    
    <a class="" href="../../dev/docs/">Documentation</a>
                </li>
                <li class="">
                    
    <a class="" href="../../dev/forms/">Forms</a>
                </li>
                <li class="">
                    
    <a class="" href="../../dev/frontend-crud/">Frontend CRUD</a>
                </li>
                <li class="">
                    
    <a class="" href="../../dev/grapher/">Grapher</a>
                </li>
                <li class="">
                    
    <a class="" href="../../dev/helpders/">Helpers</a>
                </li>
                <li class="">
                    
    <a class="" href="../../dev/looking-glass/">Looking Glass</a>
                </li>
                <li class="">
                    
    <a class="" href="../../dev/release-procedure/">Release Procedure</a>
                </li>
                <li class="">
                    
    <a class="" href="../../dev/vagrant/">Vagrant</a>
                </li>
    </ul>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">IXP Manager Documentation</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>Features &raquo;</li>
        
      
    
    <li>MAC Addresses</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="https://github.com/inex/ixp-manager-docs-md/edit/master/docs/features/layer2-addresses.md"
          class="icon icon-github"> Edit on GitHub</a>
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="mac-addresses">MAC Addresses<a class="headerlink" href="#mac-addresses" title="Permanent link"></a></h1>
<p>IXP Manager has support for layer2 / MAC addresses in two ways:</p>
<ol>
<li><strong>Discovered Addresses</strong>: a read-only table via an admin menu option called <em>MAC Addresses -&gt; Discovered Addresses</em> which lists entries from a database of MAC addresses which are sourced via a script from the IXP's switches directly. <em>(Available since version 3.x)</em>.</li>
<li><strong>Configured Addresses</strong>: a managed table of layer2/MAC addresses, viewed by the admin menu option <em>MAC Addresses -&gt; Configured Addresses</em>. These are assigned by IXP administrators on a per VLAN interface basis. <em>(Available since version 4.4)</em>.</li>
</ol>
<h2 id="configured-addresses">Configured Addresses<a class="headerlink" href="#configured-addresses" title="Permanent link"></a></h2>
<p>In early 2017, <a href="https://www.inex.ie/">INEX</a> migrated its primary peering LAN from a flat layer2 with spanning tree design to a VxLAN set-up with automation via Salt and Napalm <em>(we will insert references to presentations here once we complete all required functionality)</em>.</p>
<p>Part of the requirements for this automation (and this was an existing feature request from other IXPs) was the management of MAC addresses within IXP Manager and, rather than assigning them to a virtual interface, assign them to specific VLAN interfaces.</p>
<p>Outside of our automation and VXLAN, other uses included:</p>
<ol>
<li>to potentially allow members to add a MAC address during maintenance and thus have the system update a layer2 acl on the switch(es);</li>
<li>a static maintained database of MAC addresses for EVPN;</li>
<li>a static maintained database for lookups.</li>
</ol>
<p>The features of this system are listed below.</p>
<h3 id="listing-and-searching-existing-configured-mac-addresses">Listing and Searching Existing Configured MAC Addresses<a class="headerlink" href="#listing-and-searching-existing-configured-mac-addresses" title="Permanent link"></a></h3>
<p>There is a new menu option (left hand side menu) under <em>MAC Addresses</em> called <em>Configured Addresses</em>. This lists all configured MAC addresses including the OUI manufacturer (see below), associated switch / switch port(s), customer name, IPv4 and v6 addresses. You can also:</p>
<ul>
<li>as-you-type search from the datatable search box (lowercased and filtered to a normalised MAC address);</li>
<li>restrict the view to a single VLAN;</li>
<li>action-to-move to layer 2 address add / edit / delete for a given VLAN interface;</li>
<li>click on a MAC to bring up a pop-up, allowing you to copy in different formats:</li>
</ul>
<p><img alt="MAC Address Formats" src="../img/l2a-formats.png" /></p>
<h3 id="adding-removing-layer2-addresses-tofrom-a-vlan-interface">Adding / Removing Layer2 Addresses to/from a VLAN Interface<a class="headerlink" href="#adding-removing-layer2-addresses-tofrom-a-vlan-interface" title="Permanent link"></a></h3>
<p>When editing a customer's interface in the usual manner (customer overview -&gt; Ports -&gt; edit button), you will now see MAC address(es) under <em>VLAN Interfaces</em>:</p>
<p><img alt="MAC Address per VLAN Interface" src="../img/l2a-vlint1.png" /></p>
<p>In the event that there is zero or more than one MAC address, the MAC address demonstrated above will be replaced with an appropriate note to indicate this.</p>
<p>Clicking on the MAC address (or note when none  / multiple) will bring you to the configured MAC address management page for this VLAN interface. Addresses can be added / removed on this page. MAC addresses can be entered in either upper or lower cases and can optionally include characters such as <code>.</code>, <code>:</code>, <code>-</code>. These are all stripped before validation and insertion.</p>
<h3 id="extracting-addresses">Extracting Addresses<a class="headerlink" href="#extracting-addresses" title="Permanent link"></a></h3>
<p>As automation features are still a work in progress, not all methods are listed here. Please <a href="https://github.com/inex/IXP-Manager/issues">open an issue on GitHub</a> or start a discussion on the <a href="https://www.ixpmanager.org/support.php">mailing list</a> for whatever methods you would like.</p>
<p>Currently implemented (see <a href="../api/">the API page for access details</a>):</p>
<ol>
<li>An API to be used by the sflow / peer to peer graphing tool:<ul>
<li>Virtual Interface ID to MAC address - GET request to: https://ixp.example.com/api/v4/vlan-interface/sflow-mac-table</li>
<li>Virtual Interface ID, VLAN interface ID, customer name and VLAN tag - GET request to: https://ixp.example.com/api/v4/vlan-interface/sflow-matrix</li>
</ul>
</li>
<li>YAML export for automated provisioning. As yet undocumented and not suitable for general use.</li>
<li>Querying the database directly. <em>Not usually recommended as the schema may change.</em></li>
</ol>
<h3 id="migrating-discovered-macs-to-configured-macs">Migrating Discovered MACs to Configured MACs<a class="headerlink" href="#migrating-discovered-macs-to-configured-macs" title="Permanent link"></a></h3>
<p>INEX's use case was to switch from the <em>discovered MAC addresses</em> table to the <em>configured MAC addresses</em> table without the need to data fill all preexisting ~200 MACs. As such we have created an Artisan migration script which can be run with:</p>
<div class="highlight"><pre>php <span class="nv">$IXPROOT</span>/artisan l2addresses:populate
</pre></div>


<p>You will be prompted as follows:</p>
<blockquote>
<p>Are you sure you wish to proceed? This command will CLEAR the layer2address table and then copy addresses from the read-only macaddress table. Generally, this command should only ever be run once when initially populating the new table.</p>
</blockquote>
<p>One thing to note: as the <em>discovered MAC Addresses</em> table is per virtual interface and the new configured MAC address functionality is per VLAN interface, any MAC from <em>discovered MAC Addresses</em> that is populated into <em>confifured MAC Addresses</em> will be populated for every VLAN interface associated with the virtual interface.</p>
<p>The script prints notices for these such as:</p>
<blockquote>
<p>Created &gt;1 layer2address for [member name]] with virtual interface: https://www.example.com/ixp/virtual-interface/edit/id/235</p>
</blockquote>
<p>The inclusion of the URL makes it easy to double check the result.</p>
<p>For obvious reasons, we only allow a single / unique layer2 address per VLAN. In the event that the script tries to add the same MAC more than once, it will print:</p>
<blockquote>
<p>Could not add additional instance of 001122334455 for [Customer]] with virtual interface: https://www.example.com/ixp/virtual-interface/edit/id/265 as it already exists in this Vlan [VLAN name]</p>
</blockquote>
<p>These should all be checked manually.</p>
<p>A useful SQL command to double check the results for me was:</p>
<div class="highlight"><pre><span class="k">SELECT</span> <span class="n">mac</span><span class="p">,</span> <span class="k">COUNT</span><span class="p">(</span><span class="n">mac</span><span class="p">)</span> <span class="k">AS</span> <span class="k">c</span> <span class="k">FROM</span> <span class="n">l2address</span> <span class="k">GROUP</span> <span class="k">BY</span> <span class="n">mac</span> <span class="k">HAVING</span> <span class="k">COUNT</span><span class="p">(</span><span class="n">mac</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">;</span>
</pre></div>


<h2 id="discovered-mac-addresses">Discovered MAC Addresses<a class="headerlink" href="#discovered-mac-addresses" title="Permanent link"></a></h2>
<p>This was the original functionality - a read-only table via an admin menu option called <em>MAC Addresses -&gt; Discovered Addresses</em> which lists entries from a database of MAC addresses which are sourced via a script from the IXP's switches directly.</p>
<p>At an IXP, it can be extremely useful to have a quick look up table to see what member owns what MAC address - especially when they start injecting illegal packets into the exchange fabric.</p>
<p>We have a script, <a href="https://github.com/inex/IXP-Manager/blob/master/tools/runtime/l2database/update-l2database.pl">update-l2database.pl</a>, for this. To set it up (using Ubuntu as an example), proceed as below. We are in the process of trying to reduce the reliance on the perl library and direct database access. But for now, this script still requires it.</p>
<div class="highlight"><pre><span class="c"># If you haven&#39;t already, install the Perl library for IXP Manager:</span>
apt-get install libnet-snmp-perl libconfig-general-perl libnetaddr-ip-perl
<span class="nb">cd</span> <span class="nv">$IXPROOT</span>/tools/perl-lib/IXPManager
perl Makefile.PL
make install

<span class="c"># Then copy and edit the configuration file to set the database connection settings:</span>
cp <span class="nv">$IXPROOT</span>/tools/perl-lib/IXPManager/ixpmanager.conf /usr/local/etc/
joe /usr/local/etc/ixpmanager.conf <span class="c">#and set database settings</span>

<span class="c"># Now copy the script:</span>
cp <span class="nv">$IXPROOT</span>/tools/runtime/l2database/update-l2database.pl /usr/local/bin

<span class="c"># and then add it to your periodic cron job with:</span>
/usr/local/bin/update-l2database.pl
</pre></div>


<h2 id="oui-database">OUI Database<a class="headerlink" href="#oui-database" title="Permanent link"></a></h2>
<p>IXP Manager can store the IEEE OUI database and reference it to show the manufacturer behind a MAC address.</p>
<h3 id="populating-and-updating-the-oui-database">Populating and Updating the OUI Database<a class="headerlink" href="#populating-and-updating-the-oui-database" title="Permanent link"></a></h3>
<p>You would typically set a weekly cron job to call:</p>
<div class="highlight"><pre>php <span class="nv">$IXPROOT</span>/artisan utils:oui-update
</pre></div>


<p>which will populate / update the OUI database directly from the latest IEEE file from their website.</p>
<p>A specific file can be passed via the <code>file</code> parameter. You can also force a database reset (drop all OUI entries and re-populate) via the <code>--refresh</code> option.</p>
<p>Neither of these options are typically necessary.</p>
<h2 id="end-user-access">End User Access<a class="headerlink" href="#end-user-access" title="Permanent link"></a></h2>
<p>In v4.7.3 we introduced the ability for logged in users to management their own configured MAC addresses.</p>
<p>This is disabled by default but can be enabled with the following <code>.env</code> settings:</p>
<div class="highlight"><pre># Set this to allow customers to change their own configured MAC addresses:
IXP_FE_LAYER2_ADDRESSES_CUST_CAN_EDIT=true

# The following defaults are configured for min/max MAC addresses
IXP_FE_LAYER2_ADDRESSES_CUST_PARAMS_MIN_ADDRESSES=1
IXP_FE_LAYER2_ADDRESSES_CUST_PARAMS_MAX_ADDRESSES=2
</pre></div>


<p>When a MAC is added, a <code>IXP\Events\Layer2Address\Added</code> event is triggered and, similarly, when a MAC is deleted a <code>IXP\Events\Layer2Address\Deleted</code> event is triggered. We have created an event listener for these to fire off an email in both cases. To enable this listener, set the following <code>.env</code> settings:</p>
<div class="highlight"><pre># Trigger an email when a superuser adds/deletes a MAC:
IXP_FE_LAYER2_ADDRESSES_EMAIL_ON_SUPERUSER_CHANGE=true

# Trigger an email when a customer user adds/deletes a MAC:
IXP_FE_LAYER2_ADDRESSES_EMAIL_ON_CUSTOMER_CHANGE=true

# Destination address of the email:
IXP_FE_LAYER2_ADDRESSES_EMAIL_ON_CHANGE_DEST=ops@ixp.example.net
</pre></div>


<p>There are two files you can consider <a href="../skinning/">skinning</a> with this functionality:</p>
<ol>
<li><code>resources/views/layer2-address/emails/changed.blade.php</code> - the email which is sent when a MAC is added / removed.</li>
<li><code>resources/views/layer2-address/customer-edit-msg.foil.php</code> - an informational alert box that is shown to the customer on the MAC add/delete page to set their expectations on time to complete on the IXP end.</li>
</ol>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../member-export/" class="btn btn-neutral float-right" title="Member Export">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../looking-glass/" class="btn btn-neutral" title="Looking Glass"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
      <p>&copy; 2017-2018, Internet Neutral Exchange Association Company Limited by Guarantee (INEX).<br><a rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://licensebuttons.net/l/by-sa/4.0/80x15.png" /></a>&nbsp;This work is licensed under a <a rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License</a>.</p>
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>
    
  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://github.com/inex/ixp-manager-docs-md" class="fa fa-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href="../looking-glass/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../member-export/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script src="../../js/theme.js"></script>

</body>
</html>
