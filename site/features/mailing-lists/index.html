<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="shortcut icon" href="../../img/favicon.ico">
  <title>Mailing List Management - IXP Manager Documentation</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../../css/highlight.css">
  
  <script>
    // Current page data
    var mkdocs_page_name = "Mailing List Management";
    var mkdocs_page_input_path = "features/mailing-lists.md";
    var mkdocs_page_url = "/features/mailing-lists/";
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js"></script>
  <script src="../../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../../js/highlight.pack.js"></script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> IXP Manager Documentation</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="../..">Home</a>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Installation</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../install/">Introduction</a>
                </li>
                <li class="">
                    
    <a class="" href="../../install/automated-script/">Automated Script</a>
                </li>
                <li class="">
                    
    <a class="" href="../../install/maint-mode/">Maintenance Mode</a>
                </li>
                <li class="">
                    
    <a class="" href="../../install/manually/">Manual Installation</a>
                </li>
                <li class="">
                    
    <a class="" href="../../install/upgrading/">Upgrading</a>
                </li>
                <li class="">
                    
    <a class="" href="../../install/upgrade-v3/">Upgrade From v3</a>
                </li>
                <li class="">
                    
    <a class="" href="../../install/runtime/">Runtime Configuration</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">General Usage</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../usage/customers/">Customers / Members</a>
                </li>
                <li class="">
                    
    <a class="" href="../../usage/customer-notes/">Customer Notes</a>
                </li>
                <li class="">
                    
    <a class="" href="../../usage/customer-tags/">Customer Tags</a>
                </li>
                <li class="">
                    
    <a class="" href="../../usage/interfaces/">Customer Connections</a>
                </li>
                <li class="">
                    
    <a class="" href="../../usage/users/">Users & Contacts</a>
                </li>
                <li class="">
                    
    <a class="" href="../../usage/switches/">Switches</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Features</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../api/">API</a>
                </li>
                <li class="">
                    
    <a class="" href="../as112/">AS112</a>
                </li>
                <li class="">
                    
    <a class="" href="../console-servers/">Console Servers</a>
                </li>
                <li class="">
                    
    <a class="" href="../contact-groups/">Contact Groups</a>
                </li>
                <li class="">
                    
    <a class="" href="../patch-panels/">Cross Connects</a>
                </li>
                <li class="">
                    
    <a class="" href="../dns-arpa/">DNS / ARPA</a>
                </li>
                <li class="">
                    
    <a class="" href="../../grapher/introduction/">Grapher</a>
                </li>
                <li class="">
                    
    <a class="" href="../helpdesk/">Helpdesk Integration</a>
                </li>
                <li class="">
                    
    <a class="" href="../irrdb/">IRRDB</a>
                </li>
                <li class="">
                    
    <a class="" href="../ixf-export/">IX-F Member Export</a>
                </li>
                <li class="">
                    
    <a class="" href="../layer2-addresses/">MAC Addresses</a>
                </li>
                <li class="">
                    
    <a class="" href="../looking-glass/">Looking Glass</a>
                </li>
                <li class="">
                    
    <a class="" href="../layer2-addresses/">MAC Addresses</a>
                </li>
                <li class="">
                    
    <a class="" href="../member-export/">Member Export</a>
                </li>
                <li class=" current">
                    
    <a class="current" href="./">Mailing List Management</a>
    <ul class="subnav">
            
    <li class="toctree-l3"><a href="#mailing-list-management">Mailing List Management</a></li>
    
        <ul>
        
            <li><a class="toctree-l4" href="#configuring-available-mailing-lists">Configuring Available Mailing Lists</a></li>
        
            <li><a class="toctree-l4" href="#explanation-of-usage">Explanation of Usage</a></li>
        
            <li><a class="toctree-l4" href="#how-to-implement">How to Implement</a></li>
        
            <li><a class="toctree-l4" href="#todo">Todo</a></li>
        
            <li><a class="toctree-l4" href="#api-v1-interface-overview">API V1 Interface Overview</a></li>
        
        </ul>
    

    </ul>
                </li>
                <li class="">
                    
    <a class="" href="../nagios/">Nagios</a>
                </li>
                <li class="">
                    
    <a class="" href="../patch-panels/">Patch Panels</a>
                </li>
                <li class="">
                    
    <a class="" href="../reseller/">Reseller Functionality</a>
                </li>
                <li class="">
                    
    <a class="" href="../route-collectors/">Route Collectors</a>
                </li>
                <li class="">
                    
    <a class="" href="../route-servers/">Route Servers</a>
                </li>
                <li class="">
                    
    <a class="" href="../routers/">Router Configuration</a>
                </li>
                <li class="">
                    
    <a class="" href="../skinning/">Skinning</a>
                </li>
                <li class="">
                    
    <a class="" href="../../grapher/smokeping/">Smokeping</a>
                </li>
                <li class="">
                    
    <a class="" href="../static-content/">Static Content</a>
                </li>
                <li class="">
                    
    <a class="" href="../tacacs/">TACACS</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Grapher</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../grapher/introduction/">Introduction</a>
                </li>
                <li class="">
                    
    <a class="" href="../../grapher/api/">API &amp; Permissions</a>
                </li>
                <li class="">
                    
    <a class="" href="../../grapher/mrtg/">Backend: MRTG</a>
                </li>
                <li class="">
                    
    <a class="" href="../../grapher/sflow/">Backend: sflow</a>
                </li>
                <li class="">
                    
    <a class="" href="../../grapher/smokeping/">Backend: Smokeping</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Sflow Support</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../sflow/">Introduction</a>
                </li>
                <li class="">
                    
    <a class="" href="../sflow-p2p/">Peer-to-peer Graphs</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Development</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../dev/api/">API</a>
                </li>
                <li class="">
                    
    <a class="" href="../../dev/ci/">Continuous Integration</a>
                </li>
                <li class="">
                    
    <a class="" href="../../dev/cla/">Contributer License Agreement</a>
                </li>
                <li class="">
                    
    <a class="" href="../../dev/docker/">Docker</a>
                </li>
                <li class="">
                    
    <a class="" href="../../dev/docs/">Documentation</a>
                </li>
                <li class="">
                    
    <a class="" href="../../dev/forms/">Forms</a>
                </li>
                <li class="">
                    
    <a class="" href="../../dev/frontend-crud/">Frontend CRUD</a>
                </li>
                <li class="">
                    
    <a class="" href="../../dev/grapher/">Grapher</a>
                </li>
                <li class="">
                    
    <a class="" href="../../dev/helpders/">Helpers</a>
                </li>
                <li class="">
                    
    <a class="" href="../../dev/looking-glass/">Looking Glass</a>
                </li>
                <li class="">
                    
    <a class="" href="../../dev/release-procedure/">Release Procedure</a>
                </li>
                <li class="">
                    
    <a class="" href="../../dev/vagrant/">Vagrant</a>
                </li>
    </ul>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">IXP Manager Documentation</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>Features &raquo;</li>
        
      
    
    <li>Mailing List Management</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="https://github.com/inex/ixp-manager-docs-md/edit/master/docs/features/mailing-lists.md"
          class="icon icon-github"> Edit on GitHub</a>
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="mailing-list-management">Mailing List Management<a class="headerlink" href="#mailing-list-management" title="Permanent link"></a></h1>
<p><strong>IXP Manager</strong> has the ability to allow users to subscribe / unsubscribe from Mailman mailing lists (it should be relatively easy to expand this to other mailing list managers as the functionality is based on Mailman but not Mailman specific).</p>
<p>The following sections explain the steps in how this is set up.</p>
<p><strong>NB:</strong> This facility does not perform a 100% synchronisation. Any mailing list members that are added separately without a matching user in IXP Manager are not interfered with.</p>
<h2 id="configuring-available-mailing-lists">Configuring Available Mailing Lists<a class="headerlink" href="#configuring-available-mailing-lists" title="Permanent link"></a></h2>
<p>There is a sample configuration file which you need to copy as follows:</p>
<div class="highlight"><pre><span class="nb">cd</span> <span class="nv">$IXPROOT</span>
cp config/mailinglists.php.dist config/mailinglists.php
</pre></div>


<p>You then need to edit this file as follows:</p>
<ol>
<li>
<p>Enable the mailing list functionality by setting this to true:</p>
<div class="highlight"><pre><span class="x">// Set the following to &#39;true&#39; to enable mailing list functionality:</span>
<span class="x">&#39;enabled&#39; =&gt; true,</span>
</pre></div>


<p>If this is not set to true, the user will not be offered subscription options and the CLI/API commands will not execute.</p>
</li>
<li>
<p>Configure the available mailing list(s) in the <code>lists</code> array. Here is an example:</p>
<div class="highlight"><pre><span class="x">&#39;lists&#39; =&gt; [</span>
<span class="x">    &#39;members&#39; =&gt; [</span>
<span class="x">        &#39;name&#39;    =&gt; &quot;Members&#39; Mailing List&quot;,</span>
<span class="x">        &#39;desc&#39;    =&gt; &quot;A longer description as presented in IXP Manager.&quot;,</span>
<span class="x">        &#39;email&#39;   =&gt; &quot;members@example.com&quot;,</span>
<span class="x">        &#39;archive&#39; =&gt; &quot;https://www.example.com/mailman/private/members/&quot;,</span>
<span class="x">    ],</span>
<span class="x">    &#39;tech&#39; =&gt; [</span>
<span class="x">        &#39;name&#39;    =&gt; &quot;Tech/Operations Mailing List&quot;,</span>
<span class="x">        &#39;desc&#39;    =&gt; &quot;A longer description as presented in IXP Manager.&quot;,</span>
<span class="x">        &#39;email&#39;   =&gt; &quot;tech@example.com&quot;,</span>
<span class="x">        &#39;archive&#39; =&gt; &quot;https://www.example.com/mailman/private/tech/&quot;,</span>
<span class="x">    ],</span>
<span class="x">],</span>
</pre></div>


<p>Note that the <code>members</code> and <code>tech</code> array keys above are the list handles that will be used by the API interfaces later. It is also important that they match the Mailman list key.</p>
<p>Historically, mailing list passwords were also sync'd from the IXP Manager user database <em>unless</em> <code>syncpws</code> is both defined and false for the given list. As we are now enforcing <em>bcrypt</em> as the standard password hashing mechanism, we no longer support this and suggest allowing Mailman to manage its own passwords.</p>
</li>
<li>
<p>Paths to Mailman commands. These will be used in the API/CLI elements later:</p>
<div class="highlight"><pre><span class="x">&#39;mailman&#39; =&gt; [</span>
<span class="x">    &#39;cmds&#39; =&gt; [</span>
<span class="x">        &#39;list_members&#39;   =&gt; &quot;/usr/local/mailman/bin/list_members&quot;,</span>
<span class="x">        &#39;add_members&#39;    =&gt; &quot;/usr/local/mailman/bin/add_members -r - -w n -a n&quot;,</span>
<span class="x">        &#39;remove_members&#39; =&gt; &quot;/usr/local/mailman/bin/remove_members -f - -n -N&quot;,</span>
<span class="x">        &#39;changepw&#39;       =&gt; &quot;/usr/local/mailman/bin/withlist -q -l -r changepw&quot;</span>
<span class="x">    ]</span>
<span class="x">]</span>
</pre></div>


</li>
</ol>
<h2 id="explanation-of-usage">Explanation of Usage<a class="headerlink" href="#explanation-of-usage" title="Permanent link"></a></h2>
<p>This mailing list synchronisation / integration code was written for existing Mailman lists we have at INEX where some lists are public with subscribers that will never have an account on INEX's IXP Manager. As such, these scripts are written so that email addresses in common between IXP Manager and Mailman can manage their subscriptions in IXP Manager but those other subscribers will be unaffected.</p>
<p>Users in IXP Manager will either be marked as being subscribed to a list, not subscribed to a list or neither (i.e. a new user). Subscriptions are managed by user preferences (in the database) of the format:</p>
<div class="highlight"><pre>mailinglist.listname1.subscribed = 0/1
</pre></div>


<p>There are three steps to performing the synchronisation <strong>for each list</strong> which are done by either using the IXP Manager CLI script <code>artisan mailing-list:...</code> or the <a href="../api/">API</a> interface.</p>
<h3 id="cli-interface-overview">CLI Interface Overview<a class="headerlink" href="#cli-interface-overview" title="Permanent link"></a></h3>
<p><strong>NB:</strong> these relate to the CLI as implemented from IXP Manager &gt;= v4.7.</p>
<ol>
<li>
<p>The execution of the <code>artisan mailing-list:init</code> script which is really for new IXP Manager users (or initial set up of the mailing list feature). This script is piped the full subscribers list from Mailman (via <code>list_members</code>). This function will iterate through all users and, if they have no preference set for subscription to this list, will either add a "not subscribed" preference if their email address is not in the provided list of subscribers or a "subscribed" preference if it is.</p>
</li>
<li>
<p>The execution of the <code>artisan mailing-list:get-subscribers</code> action which lists all users who are subscribed to the given mailing list based on their user preferences. This is piped to the <code>add_members</code> Mailman script.</p>
</li>
<li>
<p>The execution of the <code>artisan mailing-list:get-subscribers --unsubscribed</code> action which lists all users who are unsubscribed to the given mailing list based on their user preferences. This is piped to the <code>remove_members</code> Mailman script.</p>
</li>
</ol>
<h3 id="api-v4-interface-overview">API V4 Interface Overview<a class="headerlink" href="#api-v4-interface-overview" title="Permanent link"></a></h3>
<p>The API v4 implementation was added in IXP Manager v4.7. See the end of this document for the API v1 implementation in previous versions of IXP Manager.</p>
<p>If you wish to use the API version, proceed as follows where:</p>
<ul>
<li><code>$KEY</code> is one of your SUPERUSER API keys (see <a href="../api/">here</a> for details);</li>
<li><code>https://ixp.example.com</code> is your IXP Manager web interface;</li>
<li><code>members</code> is an example mailing list handle as defined above in <code>$IXPROOT/config/mailinglists.php</code>.</li>
</ul>
<p>Use the initialisation function for new IXP Manager users (or initial set up of the mailing list feature) which updates IXP Manager with all currently subscribed mailing list members:</p>
<div class="highlight"><pre>/path/to/mailman/bin/list_members members &gt;/tmp/ml-members.txt
curl -f --data-urlencode addresses@/tmp/ml-members.txt <span class="se">\</span>
    -H <span class="s2">&quot;X-IXP-Manager-API-Key: </span><span class="nv">$KEY</span><span class="s2">&quot;</span> -X POST
    <span class="s2">&quot;https://ixp.example.co/api/v4/mailing-list/init/members&quot;</span>
rm /tmp/ml-members.txt
</pre></div>


<p>Pipe all subscribed users to the <code>add_members</code> Mailman script:</p>
<div class="highlight"><pre>curl -f -H <span class="s2">&quot;X-IXP-Manager-API-Key: </span><span class="nv">$KEY</span><span class="s2">&quot;</span> -X GET <span class="se">\</span>
    <span class="s2">&quot;https://ixp.example.co/api/v4/mailing-list/subscribers/members&quot;</span> <span class="p">|</span> <span class="se">\</span>
    /path/to/mailman/bin/add_members -r - -w n -a n members &gt;/dev/null
</pre></div>


<p>Pipe all users who are unsubscribed to the <code>remove_members</code> Mailman script:</p>
<div class="highlight"><pre>curl -f -H <span class="s2">&quot;X-IXP-Manager-API-Key: </span><span class="nv">$KEY</span><span class="s2">&quot;</span> -X GET <span class="se">\</span>
    <span class="s2">&quot;https://ixp.example.co/api/v4/mailing-list/unsubscribed/members&quot;</span> <span class="p">|</span> <span class="se">\</span>
    /path/to/mailman/bin/remove_members -f - -n -N members &gt;/dev/null
</pre></div>


<h2 id="how-to-implement">How to Implement<a class="headerlink" href="#how-to-implement" title="Permanent link"></a></h2>
<p>You can implement mailing list management by configuring IXP Manager as above.</p>
<p>IXP Manager will generate shell scripts to manage all of the above.</p>
<p>Execute the following command for the CLI version <strong>(and make sure to update the assignments at the top of the script)</strong>:</p>
<div class="highlight"><pre>artisan mailing-list:sync-script --sh
</pre></div>


<p>Or the following for the API V4 version <strong>(and make sure to update the assignments at the top of the script)</strong>:</p>
<div class="highlight"><pre>artisan mailing-list:sync-script
</pre></div>


<p>This generates a script which performs each of the above four steps for each configured mailing list. If your mailing list configuration does not change, you will not need to rerun this.</p>
<p>You should now put this script into crontab on the appropriate server (same server for CLI!) and run as often as you feel is necessary. The current <em>success</em> message for a user updating their subscriptions says <em>within 12 hours</em> so we'd recommend at least running twice a day.</p>
<h2 id="todo">Todo<a class="headerlink" href="#todo" title="Permanent link"></a></h2>
<ul>
<li>better handling of multiple users with the same email address and documentation of same</li>
<li>user changes email address</li>
</ul>
<h2 id="api-v1-interface-overview">API V1 Interface Overview<a class="headerlink" href="#api-v1-interface-overview" title="Permanent link"></a></h2>
<p><strong>DEPRECATED</strong> and only available in IXP Manager &lt;v4.7.</p>
<p>The CLI version of mailing list management was presented above. If you wish to use the API version, proceed as follows where:</p>
<ul>
<li><code>$MyKey</code> is one of your SUPERUSER API keys;</li>
<li><code>https://www.example.com/ixp/</code> is your IXP Manager web interface;</li>
<li><code>members</code> is an example mailing list handle as defined above in <code>$IXPROOT/config/mailinglists.php</code>.</li>
</ul>
<p>Use the initialisation function for new IXP Manager users (or initial set up of the mailing list feature) which updates IXP Manager with all currently subscribed mailing list members:</p>
<div class="highlight"><pre>/path/to/mailman/bin/list_members members &gt;/tmp/ml-listname1.txt
curl -f --data-urlencode addresses@/tmp/ml-listname1.txt <span class="se">\</span>
    <span class="s2">&quot;https://www.example.com/ixp/apiv1/mailing-list/init/key/</span><span class="nv">$MyKey</span><span class="s2">/list/members&quot;</span>
rm /tmp/ml-listname1.txt
</pre></div>


<p>Pipe all subscribed users to the <code>add_members</code> Mailman script:</p>
<div class="highlight"><pre>curl -f <span class="s2">&quot;https://www.example.com/ixp/apiv1/mailing-list/get-subscribed/key/</span><span class="nv">$MyKey</span><span class="s2">/list/members&quot;</span> <span class="p">|</span> <span class="se">\</span>
    /path/to/mailman/bin/add_members -r - -w n -a n members &gt;/dev/null
</pre></div>


<p>Pipe all users who are unsubscribed to the <code>remove_members</code> Mailman script:</p>
<div class="highlight"><pre>curl -f <span class="s2">&quot;https://www.example.com/ixp/apiv1/mailing-list/get-unsubscribed/key/</span><span class="nv">$MyKey</span><span class="s2">/list/members&quot;</span> <span class="p">|</span> <span class="se">\</span>
    /path/to/mailman/bin/remove_members -f - -n -N members &gt;/dev/null
</pre></div>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../nagios/" class="btn btn-neutral float-right" title="Nagios">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../member-export/" class="btn btn-neutral" title="Member Export"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
      <p>&copy; 2017-2018, Internet Neutral Exchange Association Company Limited by Guarantee (INEX).<br><a rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://licensebuttons.net/l/by-sa/4.0/80x15.png" /></a>&nbsp;This work is licensed under a <a rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License</a>.</p>
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>
    
  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://github.com/inex/ixp-manager-docs-md" class="fa fa-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href="../member-export/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../nagios/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script src="../../js/theme.js"></script>

</body>
</html>
