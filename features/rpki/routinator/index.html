<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="shortcut icon" href="../../../img/favicon.ico">
  <title>Routinator 3000 - IXP Manager Documentation</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
  
  <script>
    // Current page data
    var mkdocs_page_name = "Routinator 3000";
    var mkdocs_page_input_path = "features/rpki/routinator.md";
    var mkdocs_page_url = "/features/rpki/routinator/";
  </script>
  
  <script src="../../../js/jquery-2.1.1.min.js" defer></script>
  <script src="../../../js/modernizr-2.8.3.min.js" defer></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../../.." class="icon icon-home"> IXP Manager Documentation</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="../../..">Home</a>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Installation</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../../install/">Introduction</a>
                </li>
                <li class="">
                    
    <a class="" href="../../../install/automated-script/">Automated Script</a>
                </li>
                <li class="">
                    
    <a class="" href="../../../install/maint-mode/">Maintenance Mode</a>
                </li>
                <li class="">
                    
    <a class="" href="../../../install/manually/">Manual Installation</a>
                </li>
                <li class="">
                    
    <a class="" href="../../../install/upgrading/">Upgrading</a>
                </li>
                <li class="">
                    
    <a class="" href="../../../install/runtime/">Runtime Configuration</a>
                </li>
                <li class="">
                    
    <a class="" href="../../../install/next-steps/">Post-Install Steps</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">General Usage</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../../usage/operational-notes/">Operational Notes</a>
                </li>
                <li class="">
                    
    <a class="" href="../../../usage/authentication/">Authentication</a>
                </li>
                <li class="">
                    
    <a class="" href="../../../usage/contacts/">Contacts</a>
                </li>
                <li class="">
                    
    <a class="" href="../../../usage/customers/">Customers / Members</a>
                </li>
                <li class="">
                    
    <a class="" href="../../../usage/customer-notes/">Customer Notes</a>
                </li>
                <li class="">
                    
    <a class="" href="../../../usage/customer-tags/">Customer Tags</a>
                </li>
                <li class="">
                    
    <a class="" href="../../../usage/interfaces/">Customer Connections</a>
                </li>
                <li class="">
                    
    <a class="" href="../../../usage/users/">Users</a>
                </li>
                <li class="">
                    
    <a class="" href="../../../usage/switches/">Switches</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Features</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../api/">API</a>
                </li>
                <li class="">
                    
    <a class="" href="../../as112/">AS112</a>
                </li>
                <li class="">
                    
    <a class="" href="../../console-servers/">Console Servers</a>
                </li>
                <li class="">
                    
    <a class="" href="../../cronjobs/">Cron Jobs</a>
                </li>
                <li class="">
                    
    <a class="" href="../../patch-panels/">Cross Connects</a>
                </li>
                <li class="">
                    
    <a class="" href="../../dns-arpa/">DNS / ARPA</a>
                </li>
                <li class="">
                    
    <a class="" href="../../docstore/">Document Store</a>
                </li>
                <li class="">
                    
    <a class="" href="../../../grapher/introduction/">Grapher</a>
                </li>
                <li class="">
                    
    <a class="" href="../../helpdesk/">Helpdesk Integration</a>
                </li>
                <li class="">
                    
    <a class="" href="../../irrdb/">IRRDB</a>
                </li>
                <li class="">
                    
    <a class="" href="../../ixf-export/">IX-F Member Export</a>
                </li>
                <li class="">
                    
    <a class="" href="../../looking-glass/">Looking Glass</a>
                </li>
                <li class="">
                    
    <a class="" href="../../layer2-addresses/">MAC Addresses</a>
                </li>
                <li class="">
                    
    <a class="" href="../../manrs/">MANRS</a>
                </li>
                <li class="">
                    
    <a class="" href="../../member-export/">Member Export</a>
                </li>
                <li class="">
                    
    <a class="" href="../../mailing-lists/">Mailing List Management</a>
                </li>
                <li class="">
                    
    <a class="" href="../../nagios/">Nagios</a>
                </li>
                <li class="">
                    
    <a class="" href="../../patch-panels/">Patch Panels</a>
                </li>
                <li class="">
                    
    <a class="" href="../../peering-manager/">Peering Manager</a>
                </li>
                <li class="">
                    
    <a class="" href="../../peering-matrix/">Peering Matrix</a>
                </li>
                <li class="">
                    
    <a class="" href="../../peeringdb/">PeeringDB</a>
                </li>
                <li class="">
                    
    <a class="" href="../../rir-objects/">RIR Objects</a>
                </li>
                <li class="">
                    
    <a class="" href="../../reseller/">Reseller Functionality</a>
                </li>
                <li class="">
                    
    <a class="" href="../../route-collectors/">Route Collectors</a>
                </li>
                <li class="">
                    
    <a class="" href="../../route-servers/">Route Servers</a>
                </li>
                <li class="">
                    
    <a class="" href="../../routers/">Router Configuration</a>
                </li>
                <li class="">
                    
    <a class="" href="../">RPKI</a>
                </li>
                <li class="">
                    
    <a class="" href="../../skinning/">Skinning</a>
                </li>
                <li class="">
                    
    <a class="" href="../../../grapher/smokeping/">Smokeping</a>
                </li>
                <li class="">
                    
    <a class="" href="../../static-content/">Static Content</a>
                </li>
                <li class="">
                    
    <a class="" href="../../tacacs/">TACACS</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Grapher</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../../grapher/introduction/">Introduction</a>
                </li>
                <li class="">
                    
    <a class="" href="../../../grapher/api/">API &amp; Permissions</a>
                </li>
                <li class="">
                    
    <a class="" href="../../../grapher/mrtg/">Backend: MRTG</a>
                </li>
                <li class="">
                    
    <a class="" href="../../../grapher/sflow/">Backend: sflow</a>
                </li>
                <li class="">
                    
    <a class="" href="../../../grapher/smokeping/">Backend: Smokeping</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Sflow Support</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../sflow/">Introduction</a>
                </li>
                <li class="">
                    
    <a class="" href="../../sflow-p2p/">Peer-to-peer Graphs</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Development</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../../dev/introduction/">Introduction</a>
                </li>
                <li class="">
                    
    <a class="" href="../../../dev/api/">API</a>
                </li>
                <li class="">
                    
    <a class="" href="../../../dev/authentication/">Authentication</a>
                </li>
                <li class="">
                    
    <a class="" href="../../../dev/ci/">Continuous Integration</a>
                </li>
                <li class="">
                    
    <a class="" href="../../../dev/cla/">Contributer License Agreement</a>
                </li>
                <li class="">
                    
    <a class="" href="../../../dev/docker/">Docker</a>
                </li>
                <li class="">
                    
    <a class="" href="../../../dev/docs/">Documentation</a>
                </li>
                <li class="">
                    
    <a class="" href="../../../dev/forms/">Forms</a>
                </li>
                <li class="">
                    
    <a class="" href="../../../dev/frontend-crud/">Frontend CRUD</a>
                </li>
                <li class="">
                    
    <a class="" href="../../../dev/grapher/">Grapher</a>
                </li>
                <li class="">
                    
    <a class="" href="../../../dev/helpders/">Helpers</a>
                </li>
                <li class="">
                    
    <a class="" href="../../../dev/looking-glass/">Looking Glass</a>
                </li>
                <li class="">
                    
    <a class="" href="../../../dev/release-procedure/">Release Procedure</a>
                </li>
                <li class="">
                    
    <a class="" href="../../../dev/telescope/">Telescope</a>
                </li>
                <li class="">
                    
    <a class="" href="../../../dev/users/">Users</a>
                </li>
                <li class="">
                    
    <a class="" href="../../../dev/vagrant/">Vagrant</a>
                </li>
    </ul>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../..">IXP Manager Documentation</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../..">Docs</a> &raquo;</li>
    
      
    
    <li>Routinator 3000</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="https://github.com/inex/ixp-manager-docs-md/edit/master/docs/features/rpki/routinator.md"
          class="icon icon-github"> Edit on GitHub</a>
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="routinator-3000">Routinator 3000<a class="headerlink" href="#routinator-3000" title="Permanent link"></a></h1>
<p><strong>Routinator 3000</strong> is a <a href="/features/rpki.md">RPKI</a> relying party software (aka RPKI Validator) written in Rust by the good folks at <a href="https://www.nlnetlabs.nl/projects/rpki/routinator/">NLnet Labs</a>. These instructions reflect Routinator 0.4, which is set up and started differently than older versions. This mostly follows <a href="https://github.com/NLnetLabs/routinator">their own GitHub instructions</a> and <a href="https://rpki.readthedocs.io/en/latest/routinator/">documentation</a>.</p>
<p>We use a standard Ubuntu 18.04 installation (selecting the minimal virtual server option), 2 vCPUs, 2GB RAM, 10GB LVM hard drive.</p>
<p>Rather than running Routinator as the root user, we create a dedicated user:</p>
<pre class="highlight"><code class="language-sh">useradd -c 'Routinator 3000' -d /srv/routinator -m -s /bin/bash -u 1100 routinator</code></pre>

<p>We then install the required software. <code>build-essential</code> is a Ubuntu alias package that installs the common C software build suite. <code>cargo</code> is Rust's package manager and installing that automatically installs other Rust dependancies.</p>
<pre class="highlight"><code class="language-sh">apt install -y build-essential cargo rsync</code></pre>

<p>You should have rust version &gt;=1.36.0 installed (check with <code>rustc -V</code>).</p>
<p>To install Routinator, we then switch to the <code>routinator</code> user and use Cargo to build and install it:</p>
<pre class="highlight"><code class="language-sh">sudo su - routinator
cargo install routinator</code></pre>

<p>To check if this works, run the following (and note the path to the <code>routinator</code> binary):</p>
<p><pre class="highlight"><code class="language-sh">routinator@rpki01:~$ /srv/routinator/.cargo/bin/routinator -V
Routinator 0.6.1</code></pre>
Routinator needs to prepare its working environment via the <code>init</code> command, which will set up both
the directory for the local RPKI cache as well as the TAL directory. Running it will prompt you to
agree to the <a href="https://www.arin.net/resources/manage/rpki/tal/">ARIN Relying Party Agreement (RPA)</a>
so it can install the ARIN TAL along with the other four RIR TALs:</p>
<pre class="highlight"><code class="language-sh">/srv/routinator/.cargo/bin/routinator init</code></pre>

<p>To agree with the ARIN RPA, run:</p>
<pre class="highlight"><code class="language-sh">/srv/routinator/.cargo/bin/routinator init --accept-arin-rpa</code></pre>

<p>You can then test by running the following (this command prints the validated ROA payloads
and increases the log level to show the process in detail at least once):</p>
<pre class="highlight"><code class="language-sh">/srv/routinator/.cargo/bin/routinator -v vrps</code></pre>

<p>To upgrade Routinator, you reinstall it (<code>-f</code> to overwrite the older version):</p>
<pre class="highlight"><code class="language-sh">cargo install -f routinator</code></pre>

<p>After you upgrade, kill the running version of Routinator and start it again.</p>
<p>Note that in the above we are using the (sensible) configuration defaults. Read Routinator's own <a href="https://rpki.readthedocs.io/en/latest/routinator/">documentation</a> if you want to change these.</p>
<p>Start Routinator's RTR and HTTP service with:</p>
<pre class="highlight"><code>/srv/routinator/.cargo/bin/routinator server --rtr 192.0.2.13:3323 --rtr [2001:db8::13]:3323 --http 192.0.2.13:8080</code></pre>

<p>It will stay attached unless you run it with <code>-d</code> (for daemon) to start in the background. You can see log messages using:</p>
<pre class="highlight"><code class="language-sh">cat /var/log/syslog | grep routinator</code></pre>

<p>When it starts, there is a webserver on port 8080 - see <a href="https://rpki.readthedocs.io/en/latest/routinator/running.html#running-the-http-service">the documentation for the available endpoints</a>.</p>
<h2 id="starting-on-boot">Starting on Boot<a class="headerlink" href="#starting-on-boot" title="Permanent link"></a></h2>
<p>To have this service start at boot, we create systemd service files:</p>
<pre class="highlight"><code class="language-sh">cat &lt;&lt;ENDL &gt;/etc/systemd/system/rpki-routinator.service
[Unit]
Description=RPKI Routinator

[Service]
Restart=always
RestartSec=60

WorkingDirectory=/srv/routinator

User=routinator

StandardOutput=syslog
StandardError=syslog
SyslogIdentifier=rpki-routinator

ExecStart=/srv/routinator/.cargo/bin/routinator server --rtr 192.0.2.13:3323 --rtr [2001:db8::13]:3323 --http 192.0.2.13:8080



[Install]
WantedBy=multi-user.target

ENDL</code></pre>

<p>And then we enable it to start on boot:</p>
<pre class="highlight"><code class="language-sh">systemctl enable rpki-routinator.service</code></pre>

<h2 id="monitoring">Monitoring<a class="headerlink" href="#monitoring" title="Permanent link"></a></h2>
<p>We add Nagios http checks for port 8080 (HTTP) to our monitoring platform. We also add a <code>check_tcp</code> test for the RPKI-RTR port 3323.</p>
<h2 id="http-interface">HTTP Interface<a class="headerlink" href="#http-interface" title="Permanent link"></a></h2>
<p>The following is copied <a href="https://nlnetlabs.nl/documentation/rpki/routinator/">from Routinator's man page</a>. As a future work fixme, this should be used for better monitoring that just <code>check_tcp</code> above.</p>
<pre class="highlight"><code>HTTP SERVICE
       Routinator can provide an HTTP service allowing to fetch the  Validated
       ROA  Payload in various formats. The service does not support HTTPS and
       should only be used within the local network.

       The service only supports GET requests with the following paths:


       /csv   Returns the current set of VRPs in csv output format.

       /json  Returns the current set of VRPs in json output format.

       /metrics
              Returns a set of  monitoring  metrics  in  the  format  used  by
              Prometheus.

       /openbgpd
              Returns the current set of VRPs in openbgpd output format.

       /rpsl  Returns the current set of VRPs in rpsl output format.

       /status
              Returns  the  current status of the Routinator instance. This is
              similar to the output of the /metrics endpoint  but  in  a  more
              human friendly format.

       /version
              Returns the version of the Routinator instance.

       /api/v1/validity/as-number/prefix
              Returns  a JSON object describing whether the route announcement
              given by its origin AS number and address preifx is RPKI  valid,
              invalid,  or  not found.  The returned object is compatible with
              that provided by the RIPE NCC RPKI Validator. For more  informa-
              tion,  see https://www.ripe.net/support/documentation/developer-
              documentation/rpki-validator-api

       /validity?asn=as-number&amp;prefix;=prefix
              Same as above but with a more form-friendly calling convention.


       The paths that output the current set of VRPs accept filter expressions
       to  limit  the  VRPs  returned in the form of a query string. The field
       filter-asn can be used to filter for ASNs and the  field  filter-prefix
       can be used to filter for prefixes. The fields can be repeated multiple
       times.

       This works in the same way as the options of the same name to the  vrps
       command.</code></pre>
              
            </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
      <p>&copy; 2017-2020, Internet Neutral Exchange Association Company Limited by Guarantee (INEX).<br><a rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://licensebuttons.net/l/by-sa/4.0/80x15.png" /></a>&nbsp;This work is licensed under a <a rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License</a>.</p>
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://github.com/inex/ixp-manager-docs-md/" class="fa fa-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
      
    </span>
</div>
    <script>var base_url = '../../..';</script>
    <script src="../../../js/theme.js" defer></script>
      <script src="../../../search/main.js" defer></script>

</body>
</html>
