<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="canonical" href="https://docs.ixpmanager.org/features/dns-arpa/">
  <link rel="shortcut icon" href="../../img/favicon.ico">
  <title>DNS / ARPA - IXP Manager Documentation</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" />

  <link rel="stylesheet" href="../../css/theme.css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" />
  
  <script>
    // Current page data
    var mkdocs_page_name = "DNS / ARPA";
    var mkdocs_page_input_path = "features/dns-arpa.md";
    var mkdocs_page_url = "/features/dns-arpa/";
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js" defer></script>
  <script src="../../js/modernizr-2.8.3.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> IXP Manager Documentation</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../..">Home</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Installation</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../install/">Introduction</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../install/automated-script/">Automated Script</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../install/maint-mode/">Maintenance Mode</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../install/manually/">Manual Installation</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../install/upgrading/">Upgrading</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../install/runtime/">Runtime Configuration</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../install/next-steps/">Post-Install Steps</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">General Usage</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../usage/operational-notes/">Operational Notes</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../usage/authentication/">Authentication</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../usage/contacts/">Contacts</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../usage/customers/">Customers / Members</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../usage/customer-notes/">Customer Notes</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../usage/customer-tags/">Customer Tags</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../usage/interfaces/">Customer Connections</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../usage/users/">Users</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../usage/switches/">Switches</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../usage/email/">Email</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Features</span></p>
                <ul class="current">
                    <li class="toctree-l1"><a class="reference internal" href="../api/">API</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../as112/">AS112</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../console-servers/">Console Servers</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../cronjobs/">Cron Jobs</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../patch-panels/">Cross Connects</a>
                    </li>
                    <li class="toctree-l1 current"><a class="reference internal current" href="./">DNS / ARPA</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#as-json">As JSON</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#from-templates">From Templates</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#skinning-templating">Skinning / Templating</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#sample-script">Sample Script</a>
    </li>
        </ul>
    </li>
    </ul>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../docstore/">Document Store</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../grapher/introduction/">Grapher</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../helpdesk/">Helpdesk Integration</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../irrdb/">IRRDB</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../ixf-export/">IX-F Member Export</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../looking-glass/">Looking Glass</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../layer2-addresses/">MAC Addresses</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../manrs/">MANRS</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../member-export/">Member Export</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../mailing-lists/">Mailing List Management</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../nagios/">Nagios</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../patch-panels/">Patch Panels</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../peering-manager/">Peering Manager</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../peering-matrix/">Peering Matrix</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../peeringdb/">PeeringDB</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../rir-objects/">RIR Objects</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../reseller/">Reseller Functionality</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../route-collectors/">Route Collectors</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../route-servers/">Route Servers</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../routers/">Router Configuration</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../rpki/">RPKI</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../skinning/">Skinning</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../grapher/smokeping/">Smokeping</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../static-content/">Static Content</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../tacacs/">TACACS</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Grapher</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../grapher/introduction/">Introduction</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../grapher/api/">API &amp; Permissions</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../grapher/mrtg/">Backend: MRTG</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../grapher/sflow/">Backend: sflow</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../grapher/smokeping/">Backend: Smokeping</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Sflow Support</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../sflow/">Introduction</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../sflow-p2p/">Peer-to-peer Graphs</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Development</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../dev/introduction/">Introduction</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../dev/api/">API</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../dev/authentication/">Authentication</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../dev/ci/">Continuous Integration</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../dev/cla/">Contributer License Agreement</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../dev/docker/">Docker</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../dev/docs/">Documentation</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../dev/forms/">Forms</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../dev/frontend-crud/">Frontend CRUD</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../dev/grapher/">Grapher</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../dev/helpders/">Helpers</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../dev/looking-glass/">Looking Glass</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../dev/release-procedure/">Release Procedure</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../dev/telescope/">Telescope</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../dev/users/">Users</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../dev/vagrant/">Vagrant</a>
                    </li>
                </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">IXP Manager Documentation</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>Features &raquo;</li>
        
      
    
    <li>DNS / ARPA</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="https://github.com/inex/ixp-manager-docs-md/edit/master/docs/features/dns-arpa.md"
          class="icon icon-github"> Edit on GitHub</a>
      
    </li>
  </ul>
  
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="dns-arpa">DNS / ARPA<a class="headerlink" href="#dns-arpa" title="Permanent link"></a></h1>
<p>An IXP assigns each customer (an) IP address(es) from the range used on the peering LAN(s). These IP addresses can show up in traceroutes (for example) and both IXPs and customers like to have these resolve to a hostname.</p>
<p>When creating <em>VLAN Interfaces</em> in IXP Manager there is a field called <em>IPv[4/6] Hostname</em>. This is intended for this DNS ARPA purpose. Some customers have specific requirements for these while other smaller customers may not fully understand the use cases. At INEX, we typically default to entries such as:</p>
<ul>
<li><code>customer-name.v4.example.com</code> (where <em>example.com</em> would be <em>inex.ie</em> in our case)</li>
<li><code>customer-name.v6.example.com</code></li>
</ul>
<p><strong>IXP Manager</strong> can generate your ARPA DNS entries for your peering IP space as per the hostnames configured on each VLAN interface and provide them in two ways:</p>
<ul>
<li>as JSON;</li>
<li>as text based on a template (IXP Manager comes with a <em>ISC Bind</em> format example)</li>
</ul>
<p>Both of these are explained below.</p>
<p>Note that the API endpoints below can be tested in your browser by directly accessing the URLs <strong>when logged in</strong>. Otherwise, you need an <a href="../../dev/api/">API key</a> when using them in scripts.</p>
<h2 id="as-json">As JSON<a class="headerlink" href="#as-json" title="Permanent link"></a></h2>
<p>You can use the <strong>IXP Manager</strong> API to get all ARPA entries for a given VLAN and protocol as a JSON object using the following endpoint format:</p>
<pre class="highlight"><code>https://ixp.example.com/api/v4/dns/arpa/{vlanid}/{protocol}</code></pre>

<p>where:</p>
<ul>
<li><code>vlanid</code> is the database ID (<em>DB ID</em>) of the VLAN. You can find the DB ID in IXP Manager in the VLAN table (select <em>VLANs</em> from the left hand side menu).</li>
<li><code>protocol</code> is either <code>4</code> for IPv4 or 6 for <code>IPv6</code>.</li>
</ul>
<p>If either of these are invalid, the API will return with a HTTP 404 response.</p>
<p>And example of the JSON response returned is:</p>
<pre class="highlight"><code class="language-json">[
    {
        "enabled": true,
        "address": "192.0.2.67",
        "hostname": "cherrie.example.com",
        "arpa": "67.2.0.192.in-addr.arpa."
    },
    ...
]</code></pre>

<p>where:</p>
<ul>
<li><code>enabled</code> indicates if the protocol has been enabled for this user. This is nearly always true. A situation where it may be false is if you enabled IPv6 for a user; then that user subsequently decided to not use IPv6; then you unchecked the <em>IPv6 Enabled</em> box in the VLAN Interface form without removing address / hostname entries.</li>
<li><code>address</code> - this IPv4/6 address of the VLAN interface as assigned by the IXP.</li>
<li><code>hostname</code> - the configured hostname for this address as entered into <strong>IXP Manager</strong>.</li>
<li><code>arpa</code>: the generated ARPA record name for the IP address assigned by the IXP.</li>
</ul>
<p>You can now feed the JSON object into a script to create your own DNS zones appropriate to your DNS infrastructure.</p>
<p>When scripting, we would normally pull the JSON object using something like:</p>
<pre class="highlight"><code class="language-bash">#! /usr/bin/env bash

KEY="your-ixp-manager-api-key"
URL="https://ixp.example.com/api/v4/dns/arpa"
VLANIDS="1 2"
PROTOCOLS="4 6"

for v in $VLANIDS; do
    for p in $PROTOCOLS; do

        cmd="/usr/local/bin/curl --fail -s             \
            -H \"X-IXP-Manager-API-Key: ${KEY}\"       \
            ${URL}/${v}/${p}                           \
                &gt;/tmp/dns-arpa-vlanid$v-ipv$p.json.$$"
        eval $cmd

        if [[ $? -ne 0 ]]; then
            echo "ERROR: non-zero return from DNS ARPA API call for vlan ID $v with protocol $p"
            continue
        fi

        // do something

        rm /tmp/dns-arpa-vlanid$v-ipv$p.json.$$
    done
done</code></pre>

<h2 id="from-templates">From Templates<a class="headerlink" href="#from-templates" title="Permanent link"></a></h2>
<p>Rather than writing your own scripts to consume the JSON object as above, it may be easier to use the bundled ISC Bind templates or to write your own template for IXP Manager.</p>
<p>You can use the <strong>IXP Manager</strong> API to get all ARPA entries for a given VLAN and protocol as plain text based on a template by using the following API endpoint:</p>
<pre class="highlight"><code>https://ixp.example.com/api/v4/dns/arpa/{vlanid}/{protocol}/{template}</code></pre>

<p>where:</p>
<ul>
<li><code>vlanid</code> and <code>protocol</code> is as above in <em>As JSON</em>.</li>
<li><code>template</code> is the name of a template file residing in the view path <code>api/v4/dns/</code>.</li>
</ul>
<p>Remember that the included ISC Bind templates can be <a href="../skinning/">skinned</a> or you can add custom templates to your skin directory. More detail on this can be found in the dedicated section below.</p>
<p>The bundled ISC Bind templates can be used by setting <code>{template}</code> to <code>bind</code> or <code>bind-full</code> in the above URL. For the example interface in the JSON above, the ISC Bind <code>bind</code> template would yield:</p>
<pre class="highlight"><code>67.2.0.192.in-addr.arpa.       IN   PTR     cherrie.example.com.</code></pre>

<p><em>(note that the terminated period on the hostname is added by the template)</em></p>
<p>The two bundled templates are:</p>
<ul>
<li><code>bind</code>: outputs resource records only as per the above example.</li>
<li><code>bind-full</code>: outputs a complete Bind zone file including head and serialized serial number (UNIX timestamp). This must be templated as it uses <code>example.com</code> for email and name server domains.</li>
</ul>
<h3 id="skinning-templating">Skinning / Templating<a class="headerlink" href="#skinning-templating" title="Permanent link"></a></h3>
<p>You can use <a href="../skinning/">skinning</a> to make changes to the bundled ISC Bind template or add your own.</p>
<p>Let's say you wanted to add your own template called <code>mytemplate1</code> and your skin is named <code>myskin</code>. The best way to proceed is to copy the bundled example:</p>
<pre class="highlight"><code class="language-sh">cd $IXPROOT
mkdir -p resources/skins/myskin/api/v4/dns
cp resources/views/api/v4/dns/bind.foil.php resources/skins/myskin/api/v4/dns/mytemplate1.foil.php</code></pre>

<p>You can now edit this template as required. The only constraint on the template name is it can only contain characters from the classes <code>a-z, 0-9, -</code>. <strong>NB:</strong> do not use uppercase characters.</p>
<blockquote>
<p><strong>Contribute back</strong> - if you write a useful generator, please open a pull request and contribute it back to the project.</p>
</blockquote>
<p>The following variables are available in the template:</p>
<ul>
<li><code>$t-&gt;arpa</code>: array of the ARPA entries - see below.</li>
<li><code>$t-&gt;vlan</code>: instance of the <a href="https://github.com/inex/IXP-Manager/blob/master/database/Entities/Vlan.php"><code>Vlan</code> entity object</a>.</li>
<li><code>$t-&gt;protocol</code>: either <code>4</code> or <code>6</code>.</li>
</ul>
<p>The following variables are available for each element of the <code>$t-&gt;arpa</code> array (essentially the same as the JSON object above): <code>enabled, hostname, address, arpa</code>. See above for a description.</p>
<p>The actual code in the bundled ISC Bind sample is as simple as:</p>
<pre class="highlight"><code class="language-php">&lt;?php foreach( $t-&gt;arpa as $a ): ?&gt;
&lt;?= trim($a['arpa']) ?&gt;    IN      PTR     &lt;?= trim($a['hostname']) ?&gt;.
&lt;?php endforeach; ?&gt;</code></pre>

<h3 id="sample-script">Sample Script<a class="headerlink" href="#sample-script" title="Permanent link"></a></h3>
<p>At INEX, we have (for example) one peering LAN that is a /25 IPv4 network and so is not a zone file in its own right. As such, we make up the zone file using includes. The main zone file looks like:</p>
<pre class="highlight"><code>$TTL 86400

$INCLUDE /usr/local/etc/namedb/zones/soa-0.2.192.in-addr.arpa.inc

$INCLUDE zones/inex-dns-slave-nslist.inc

$INCLUDE zones/reverse-mgmt-hosts-ipv4.include
$INCLUDE zones/reverse-vlan-12-ipv4.include</code></pre>

<p>The SOA file looks like (as you might expect):</p>
<pre class="highlight"><code>@               IN      SOA     ns.example.come.     hostmaster.example.com. (
                        2017051701      ; Serial
                        43200           ; Refresh
                        7200            ; Retry
                        1209600         ; Expire
                        7200 )          ; Minimum</code></pre>

<p>The <code>reverse-vlan-12-ipv4.include</code> is the output of the ISC Bind <code>bind</code> template above for a given VLAN ID.</p>
<p>We use the sample script <code>update-dns-from-ixp-manager.sh</code> which can be found <a href="https://github.com/inex/IXP-Manager/blob/master/tools/runtime/dns-arpa">in this directory</a> to keep this updated ourselves.</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../docstore/" class="btn btn-neutral float-right" title="Document Store">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../patch-panels/" class="btn btn-neutral" title="Cross Connects"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
      <p>&copy; 2017-2020, Internet Neutral Exchange Association Company Limited by Guarantee (INEX).<br><a rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://licensebuttons.net/l/by-sa/4.0/80x15.png" /></a>&nbsp;This work is licensed under a <a rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License</a>.</p>
    
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://github.com/inex/ixp-manager-docs-md/" class="fa fa-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href="../patch-panels/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../docstore/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme.js" defer></script>
      <script src="../../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
